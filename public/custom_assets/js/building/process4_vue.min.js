var testVue2=new Vue({el:"#root",data:{tranformer_info:[],month_template:Immutable.Map({year:(new Date).getFullYear()+543,month:1,on_peak:0,off_peak:0,holiday:0,cost_need:0,power_used:0,cost_true:0}),tranformer_info_template:Immutable.Map({electric_user_no:null,elec_meter_no:null,elec_use_type:1,electric_ratio:1,tranformer_power:null,amount:null,electric_used_per_years:[]}),loading:!1},created:function(){var e=this;e.loading=!0,axios.get(getBuildingAjaxUrl+mainId).then(function(n){e.tranformer_info=n.data,e.tranformer_info=e.tranformer_info.map(function(n){if(n.electric_used_per_years.length<=0){var t=e.month_template.toObject();n.electric_used_per_years.push(t)}return n}),e.loading=!1}).catch(function(n){console.log(n),e.loading=!1})},methods:{addMonth:function(e){var n=this;n.tranformer_info=n.tranformer_info.map(function(t){return t===e&&t.electric_used_per_years.push(n.month_template.toObject()),t})},removeMonth:function(e,n){var t=this,r=!1;if(t.tranformer_info.map(function(n){n===e&&n.electric_used_per_years.length<=1&&(r=!0)}),r)return swal("ต้องมีเดือนอย่างน้อย 1 เดือน","","warning"),!1;swal({title:"ยืนยันการลบ?",text:"ยืนยันการลบเดือนหรือไม่?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก"}).then(function(){t.tranformer_info=t.tranformer_info.map(function(t){return t===e&&t.electric_used_per_years.splice(t.electric_used_per_years.indexOf(n),1),t})})},addTI:function(){var e=this,n=e.tranformer_info_template.toObject();n.electric_used_per_years=[],n.electric_used_per_years.push(e.month_template.toObject()),e.tranformer_info.push(n)},removeTI:function(e){var n=this;if(this.tranformer_info.length<=1)return swal("ต้องมีหม้อแปลงอย่างน้อย 1 หม้อแปลง","","warning"),!1;swal({title:"ยืนยันการลบ?",text:"ยืนยันการลบหม้อแปลงหรือไม่?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก"}).then(function(){n.tranformer_info.splice(n.tranformer_info.indexOf(e),1)})},hasNull:function(e){for(var n in e)if(null===e[n]||""===e[n])return!0;return!1},saveData:function(){var e=!0,n=this,t=$('input[name="_token"]').val();if(n.loading=!0,this.tranformer_info.forEach(function(t){n.hasNull(t)&&(e=!1)}),!e)return swal("กรุณากรอกข้อมูลให้ครบก่อนบันทึก","","warning"),n.loading=!1,!1;axios.post(getBuildingAjaxUrl+mainId,{tranformer_info:n.tranformer_info,_token:t}).then(function(e){window.location="/building/process5/"+mainId+"/edit"}).then(function(e){console.log(e),n.loading=!1})}}});