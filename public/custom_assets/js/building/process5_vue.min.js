Vue.component("select2",{props:["options","value"],template:"#select2-template",mounted:function(){var e=this;$(this.$el).val(this.value).select2({data:this.options}).on("change",function(){e.$emit("input",this.value)})},watch:{value:function(e){$(this.$el).val(e)},options:function(e){var t=this;$(this.$el).select2({data:e}),setTimeout(function(){$(t.$el).val(t.value).trigger("change")},500)}},destroyed:function(){$(this.$el).off().select2("destroy")}});var externalTemplate=Immutable.Map({et_id:0});Vue.component("my-card",{template:"#my-content",props:["energy_type"],data:function(){return{energy_and_juristic:[],month_template:Immutable.Map({year:(new Date).getFullYear()+543,month:1,unit:null,cost_unit:null,total_cost:null,mj:null}),energy_and_juristic_template:Immutable.Map({et_id:0,energy_used_per_years:[]}),options:[],loading:!1}},created:function(){var e=this;e.loading=!0,axios.get(energyAndJuristicUrl+mainId,{params:{energy_type:e.energy_type}}).then(function(t){e.energy_and_juristic=t.data,e.energy_and_juristic=e.energy_and_juristic.map(function(t){if(t.energy_used_per_years.length<=0){var n=e.month_template.toObject();t.energy_used_per_years.push(n)}return t}),e.loading=!1}).catch(function(t){console.log(t),e.loading=!1}),axios.get(energyTypeUrl,{params:{type:e.energy_type}}).then(function(t){e.options=t.data}).catch(function(e){console.log(e)})},methods:{addMonth:function(e){var t=this;t.energy_and_juristic=t.energy_and_juristic.map(function(n){return n===e&&n.energy_used_per_years.push(t.month_template.toObject()),n})},removeMonth:function(e,t){var n=this,r=!1;if(n.energy_and_juristic.map(function(t){t===e&&t.energy_used_per_years.length<=1&&(r=!0)}),r)return swal("ต้องมีเดือนอย่างน้อย 1 เดือน","","warning"),!1;swal({title:"ยืนยันการลบ?",text:"ยืนยันการลบเดือนหรือไม่?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก"}).then(function(){n.energy_and_juristic=n.energy_and_juristic.map(function(n){return n===e&&n.energy_used_per_years.splice(n.energy_used_per_years.indexOf(t),1),n})})},addCard:function(){var e=externalTemplate.toObject();e.energy_used_per_years=[],e.energy_used_per_years.push(this.month_template.toObject()),this.energy_and_juristic.push(e)},removeCard:function(e){var t=this;if(this.energy_and_juristic.length<=1)return swal("ต้องมีเชื้อเพลิงอย่างน้อย 1 เชื้อเพลิง","","warning"),!1;swal({title:"ยืนยันการลบ?",text:"ยืนยันการลบเชื้อเพลิงหรือไม่?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก"}).then(function(){t.energy_and_juristic.splice(t.energy_and_juristic.indexOf(e),1)})},getEnergyTypeData:function(e,t){var n=this.options.filter(function(t){return t.id.toString()===e.et_id.toString()});return n.length>0&&n[0][t].trim()?("heat_rate"==t&&e.energy_used_per_years.map(function(e){return e.mj=e.unit*parseFloat(n[0][t].trim()),e.total_cost=e.unit*e.cost_unit,e}),n[0][t]):("heat_rate"==t&&e.energy_used_per_years.map(function(e){return e.mj=null,e.total_cost=e.unit*e.cost_unit,e}),"ไม่มี")}}});var myVue=new Vue({el:"#root",data:{loading:!1,energy_and_juristic:[]},methods:{hasNull:function(e){for(var t in e)if(null===e[t]||""===e[t])return!0;return!1},saveData:function(){var e=!0,t=this,n=$('input[name="_token"]').val();if(this.energy_and_juristic=this.energy_and_juristic.concat(this.$refs.nonrenewable_energy.$data.energy_and_juristic),this.energy_and_juristic=this.energy_and_juristic.concat(this.$refs.renewable_energy.$data.energy_and_juristic),t.loading=!0,this.energy_and_juristic.forEach(function(t){0===parseInt(t.et_id)&&(e=!1),t.energy_used_per_years.forEach(function(t){null!==t.year&&null!==t.unit&&null!==t.cost_unit||(e=!1)})}),!e)return swal("กรุณากรอกข้อมูลให้ครบก่อนบันทึก","","warning"),t.loading=!1,!1;axios.post(process5Url+mainId,{energy_and_juristic:t.energy_and_juristic,_token:n}).then(function(e){window.location="/building/process6/"+mainId+"/edit"}).then(function(e){console.log(e),t.loading=!1})}}});